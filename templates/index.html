<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TM2020 Map Randomizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="{{url_for('static', filename='main.css')}}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  </head>
  <body>
    <header class="d-flex flex-column justify-content-center align-items-center">
      <p class="m-0 fs-4 fw-bold fst-italic">TRACKMANIA 2020</p>
      <p class="m-0 fs-4 fw-bold fst-italic">Map Randomizer</p>
    </header>
    <main class="container-sm">
      <ul class="fs-6 mt-2">
        <li>Add maps to your "Favorites" tab</li>
        <li>Leave everything blank to get a random map</li>
        <li>You can fill in one or more of these fields</li>
        <li>At a time, a max of 30 maps can be added</li>
      </ul>
      <p class="ms-2">
        Iâ€™m not affiliated with Ubisoft, Nadeo, Trackmania or Trackmania Exchange in any way, just a casual mayonnaise slider
      </p>
      <div class="col-12 col-md-6 col-lg-4 pe-2 ps-2 pt-2">
        <select class="form-select mb-3 bg-dark text-light border-light" id="tags">
          <option value="" selected>Tags / Styles</option>
          <option value="49" data-select2-id="47">Altered Nadeo</option>
          <option value="40" data-select2-id="48">Arena</option>
          <option value="34" data-select2-id="49">Backwards</option>
          <option value="44" data-select2-id="50">Bobsleigh</option>
          <option value="56" data-select2-id="51">Bugslide</option>
          <option value="20" data-select2-id="52">Bumper</option>
          <option value="13" data-select2-id="53">Competitive</option>
          <option value="62" data-select2-id="54">CruiseControl</option>
          <option value="59" data-select2-id="55">DesertCar</option>
          <option value="15" data-select2-id="56">Dirt</option>
          <option value="42" data-select2-id="57">Educational</option>
          <option value="24" data-select2-id="58">Endurance</option>
          <option value="35" data-select2-id="59">EngineOff</option>
          <option value="46" data-select2-id="60">FlagRush</option>
          <option value="21" data-select2-id="61">Fragile</option>
          <option value="48" data-select2-id="62">Freeblocking</option>
          <option value="41" data-select2-id="63">Freestyle</option>
          <option value="2" data-select2-id="64">FullSpeed</option>
          <option value="33" data-select2-id="65">Grass</option>
          <option value="14" data-select2-id="66">Ice</option>
          <option value="23" data-select2-id="67">Kacky</option>
          <option value="5" data-select2-id="68">LOL</option>
          <option value="66" data-select2-id="69">Magnet</option>
          <option value="25" data-select2-id="70">Mini</option>
          <option value="30" data-select2-id="71">Minigame</option>
          <option value="27" data-select2-id="72">Mixed</option>
          <option value="55" data-select2-id="73">MixedCar</option>
          <option value="58" data-select2-id="74">Moving Items</option>
          <option value="57" data-select2-id="75">Mudslide</option>
          <option value="8" data-select2-id="76">MultiLap</option>
          <option value="28" data-select2-id="77">Nascar</option>
          <option value="61" data-select2-id="78">NoBrake</option>
          <option value="67" data-select2-id="79">NoGrip</option>
          <option value="63" data-select2-id="80">NoSteer</option>
          <option value="31" data-select2-id="81">Obstacle</option>
          <option value="9" data-select2-id="82">Offroad</option>
          <option value="45" data-select2-id="83">Pathfinding</option>
          <option value="65" data-select2-id="84">Pipes</option>
          <option value="39" data-select2-id="85">Plastic</option>
          <option value="18" data-select2-id="86">Platform</option>
          <option value="6" data-select2-id="87">Press Forward</option>
          <option value="47" data-select2-id="88">Puzzle</option>
          <option value="1" data-select2-id="89">Race</option>
          <option value="54" data-select2-id="90">RallyCar</option>
          <option value="17" data-select2-id="91">Reactor</option>
          <option value="26" data-select2-id="92">Remake</option>
          <option value="37" data-select2-id="93">Royal</option>
          <option value="4" data-select2-id="94">RPG</option>
          <option value="64" data-select2-id="95">RPG-Immersive</option>
          <option value="43" data-select2-id="96">Sausage</option>
          <option value="22" data-select2-id="97">Scenery</option>
          <option value="36" data-select2-id="98">Signature</option>
          <option value="19" data-select2-id="99">Slow Motion</option>
          <option value="50" data-select2-id="100">SnowCar</option>
          <option value="29" data-select2-id="101">SpeedDrift</option>
          <option value="12" data-select2-id="102">SpeedFun</option>
          <option value="60" data-select2-id="103">SpeedMapping</option>
          <option value="7" data-select2-id="104">SpeedTech</option>
          <option value="16" data-select2-id="105">Stunt</option>
          <option value="3" data-select2-id="106">Tech</option>
          <option value="32" data-select2-id="107">Transitional</option>
          <option value="10" data-select2-id="108">Trial</option>
          <option value="53" data-select2-id="109">Turtle</option>
          <option value="52" data-select2-id="110">Underwater</option>
          <option value="38" data-select2-id="111">Water</option>
          <option value="51" data-select2-id="112">Wood</option>
          <option value="11" data-select2-id="113">ZrT</option>
        </select>

        <select class="form-select mb-3 bg-dark text-light border-light" id="vehicles">
          <option value="" selected>Vehicles</option>
          <option value="1" data-select2-id="143">CarSport</option>
          <option value="2" data-select2-id="144">CarSnow</option>
          <option value="3" data-select2-id="145">CarRally</option>
          <option value="4" data-select2-id="146">CarDesert</option>
        </select>

        <select class="form-select mb-3 bg-dark text-light border-light" id="etags">
          <option value="" selected>Exclude Tags/Styles</option>
          <option value="49" data-select2-id="166">Altered Nadeo</option>
          <option value="40" data-select2-id="167">Arena</option>
          <option value="34" data-select2-id="168">Backwards</option>
          <option value="44" data-select2-id="169">Bobsleigh</option>
          <option value="56" data-select2-id="170">Bugslide</option>
          <option value="20" data-select2-id="171">Bumper</option>
          <option value="13" data-select2-id="172">Competitive</option>
          <option value="62" data-select2-id="173">CruiseControl</option>
          <option value="59" data-select2-id="174">DesertCar</option>
          <option value="15" data-select2-id="175">Dirt</option>
          <option value="42" data-select2-id="176">Educational</option>
          <option value="24" data-select2-id="177">Endurance</option>
          <option value="35" data-select2-id="178">EngineOff</option>
          <option value="46" data-select2-id="179">FlagRush</option>
          <option value="21" data-select2-id="180">Fragile</option>
          <option value="48" data-select2-id="181">Freeblocking</option>
          <option value="41" data-select2-id="182">Freestyle</option>
          <option value="2" data-select2-id="183">FullSpeed</option>
          <option value="33" data-select2-id="184">Grass</option>
          <option value="14" data-select2-id="185">Ice</option>
          <option value="23" data-select2-id="186">Kacky</option>
          <option value="5" data-select2-id="187">LOL</option>
          <option value="66" data-select2-id="188">Magnet</option>
          <option value="25" data-select2-id="189">Mini</option>
          <option value="30" data-select2-id="190">Minigame</option>
          <option value="27" data-select2-id="191">Mixed</option>
          <option value="55" data-select2-id="192">MixedCar</option>
          <option value="58" data-select2-id="193">Moving Items</option>
          <option value="57" data-select2-id="194">Mudslide</option>
          <option value="8" data-select2-id="195">MultiLap</option>
          <option value="28" data-select2-id="196">Nascar</option>
          <option value="61" data-select2-id="197">NoBrake</option>
          <option value="67" data-select2-id="198">NoGrip</option>
          <option value="63" data-select2-id="199">NoSteer</option>
          <option value="31" data-select2-id="200">Obstacle</option>
          <option value="9" data-select2-id="201">Offroad</option>
          <option value="45" data-select2-id="202">Pathfinding</option>
          <option value="65" data-select2-id="203">Pipes</option>
          <option value="39" data-select2-id="204">Plastic</option>
          <option value="18" data-select2-id="205">Platform</option>
          <option value="6" data-select2-id="206">Press Forward</option>
          <option value="47" data-select2-id="207">Puzzle</option>
          <option value="1" data-select2-id="208">Race</option>
          <option value="54" data-select2-id="209">RallyCar</option>
          <option value="17" data-select2-id="210">Reactor</option>
          <option value="26" data-select2-id="211">Remake</option>
          <option value="37" data-select2-id="212">Royal</option>
          <option value="4" data-select2-id="213">RPG</option>
          <option value="64" data-select2-id="214">RPG-Immersive</option>
          <option value="43" data-select2-id="215">Sausage</option>
          <option value="22" data-select2-id="216">Scenery</option>
          <option value="36" data-select2-id="217">Signature</option>
          <option value="19" data-select2-id="218">Slow Motion</option>
          <option value="50" data-select2-id="219">SnowCar</option>
          <option value="29" data-select2-id="220">SpeedDrift</option>
          <option value="12" data-select2-id="221">SpeedFun</option>
          <option value="60" data-select2-id="222">SpeedMapping</option>
          <option value="7" data-select2-id="223">SpeedTech</option>
          <option value="16" data-select2-id="224">Stunt</option>
          <option value="3" data-select2-id="225">Tech</option>
          <option value="32" data-select2-id="226">Transitional</option>
          <option value="10" data-select2-id="227">Trial</option>
          <option value="53" data-select2-id="228">Turtle</option>
          <option value="52" data-select2-id="229">Underwater</option>
          <option value="38" data-select2-id="230">Water</option>
          <option value="51" data-select2-id="231">Wood</option>
          <option value="11" data-select2-id="232">ZrT</option>
        </select>

        <select class="form-select mb-3 bg-dark text-light border-light" id="difficulty">
          <option value="" selected>Difficulty</option>
          <option value="0" data-select2-id="234">Beginner</option>
          <option value="1" data-select2-id="235">Intermediate</option>
          <option value="2" data-select2-id="236">Advanced</option>
          <option value="3" data-select2-id="237">Expert</option>
          <option value="4" data-select2-id="238">Lunatic</option>
          <option value="5" data-select2-id="239">Impossible</option>
        </select>

        <label for="numberInput">Mapper ID (for mapper specific maps)</label>
        <input type="number" class="form-control mb-3 bg-dark text-light border-light" id="mapperId" placeholder="Author ID">

        <label for="numberInput">How many maps?</label>
        <input type="number" class="form-control mb-3 bg-dark text-light border-light" id="numberInput" name="numberInput" min="1" max="30" placeholder="1-30">

        <label for="cookieInput">Cookie
          <i id="info" class="bi bi-info-circle" data-bs-toggle="modal" data-bs-target="#exampleModal"></i></label>
        <input type="text" class="form-control mb-3 bg-dark text-light border-light" id="cookieInput" name="cookieInput" placeholder="Enter Cookie">

        <button type="button" style="background: #00955b;" class="btn btn-secondary" onclick="randomly_add_track()">Surprise Me!</button>
      </div>
    </main>
    <div id="loader">Loading...</div>

    

    <div class="modal bg-dark text-light" tabindex="-1" id="exampleModal">
      <div class="modal-dialog bg-dark text-light">
        <div class="modal-content bg-dark text-light">
          <div class="modal-header bg-dark text-light" data-bs-theme="dark">
            <h5 class="modal-title bg-dark text-light">How to get Cookie</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body bg-dark text-light" id="cookie-image-div">
            <p>Login to Trackmania Exchange using your Ubisoft Account</p>
            <p>Whenever you add a map to your favorites, in the Chrome Developer Tools, you can see a network call</p>
            <p>Check the request headers for that API call and you can then extract the Cookie used to authenticate your session</p>
            <img id="cookie-image" src="{{url_for('static', filename='cookie.png')}}">
          </div>
        </div>
      </div>
    </div>

    <div class="toast-container position-fixed top-0 end-0 p-3">
      <div id="liveToast" class="toast bg-dark text-light" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-dark text-light" data-bs-theme="dark">
          <strong class="me-auto bg-dark text-light">Message</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toast-body">
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script type="text/javascript">
      function randomly_add_track() {
        
        const loader = document.getElementById('loader');
        loader.style.display = 'flex';

        var tags = document.getElementById("tags").value;
        var difficulty = document.getElementById("difficulty").value;
        var etags = document.getElementById("etags").value;
        var vehicles = document.getElementById("vehicles").value;
        var authorid = document.getElementById("mapperId").value;
        var count = document.getElementById("numberInput").value;
        var cookie = document.getElementById("cookieInput").value;
        
        // Define the payload
        const payload = {
          tags: tags,
          difficulty: difficulty,
          etags: etags,
          vehicles: vehicles,
          authorid: authorid,
          count: count,
          cookie: cookie
        };

        // Make the POST request
        fetch('/add_track', {
          method: 'POST', // Use the POST method
          headers: {
            'Content-Type': 'application/json' // Specify the content type as JSON
          },
          body: JSON.stringify(payload) // Convert the payload to a JSON string
        })
        .then(response => { //Toast Error Message
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json(); // Parse the JSON response
        })
        .then(data => {
          const toastLiveExample = document.getElementById('liveToast');
          const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
          document.getElementById('toast-body').innerHTML = data.message;
          toastBootstrap.show();
        })
        .catch(error => {
          console.error('Error:', error); // Handle errors
        })
        .finally(() => {
          loader.style.display = 'none';
        });
      }
    </script>

  </body>
</html>